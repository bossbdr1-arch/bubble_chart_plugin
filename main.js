/*! For license information please see main.js.LICENSE.txt */
(()=>{function _regenerator(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function o(n,r,a,o){var s=r&&r.prototype instanceof c?r:c,u=Object.create(s.prototype);return _regeneratorDefine2(u,"_invoke",function(n,r,a){var o,c,s,u=0,l=a||[],p=!1,f={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,n){return o=t,c=0,s=e,f.n=n,i}};function d(n,r){for(c=n,s=r,t=0;!p&&u&&!a&&t<l.length;t++){var a,o=l[t],d=f.p,h=o[2];n>3?(a=h===r)&&(s=o[(c=o[4])?5:(c=3,3)],o[4]=o[5]=e):o[0]<=d&&((a=n<2&&d<o[1])?(c=0,f.v=r,f.n=o[1]):d<h&&(a=n<3||o[0]>r||r>h)&&(o[4]=n,o[5]=r,f.n=h,c=0))}if(a||n>1)return i;throw p=!0,r}return function(a,l,h){if(u>1)throw TypeError("Generator is already running");for(p&&1===l&&d(l,h),c=l,s=h;(t=c<2?e:s)||!p;){o||(c?c<3?(c>1&&(f.n=-1),d(c,s)):f.n=s:f.v=s);try{if(u=2,o){if(c||(a="next"),t=o[a]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=o.return)&&t.call(o),c<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),c=1);o=e}else if((t=(p=f.n<0)?s:n.call(r,f))!==i)break}catch(t){o=e,c=1,s=t}finally{u=1}}return{value:t,done:p}}}(n,a,o),!0),u}var i={};function c(){}function s(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(_regeneratorDefine2(t={},r,function(){return this}),t),p=u.prototype=c.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,_regeneratorDefine2(e,a,"GeneratorFunction")),e.prototype=Object.create(p),e}return s.prototype=u,_regeneratorDefine2(p,"constructor",u),_regeneratorDefine2(u,"constructor",s),s.displayName="GeneratorFunction",_regeneratorDefine2(u,a,"GeneratorFunction"),_regeneratorDefine2(p),_regeneratorDefine2(p,a,"Generator"),_regeneratorDefine2(p,r,function(){return this}),_regeneratorDefine2(p,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:o,m:f}})()}function _regeneratorDefine2(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}_regeneratorDefine2=function(e,t,n,r){function o(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},_regeneratorDefine2(e,t,n,r)}function asyncGeneratorStep(e,t,n,r,a,o,i){try{var c=e[o](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,a)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function i(e){asyncGeneratorStep(o,r,a,i,c,"next",e)}function c(e){asyncGeneratorStep(o,r,a,i,c,"throw",e)}i(void 0)})}}var PLUGIN_CONFIG={appId:"",appSecret:"",apiBase:"https://open.feishu.cn/open-apis",timeout:3e4},chart=null,currentData=[],feishuClient=null;function initPlugin(){return _initPlugin.apply(this,arguments)}function _initPlugin(){return(_initPlugin=_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,console.log("ğŸš€ åˆå§‹åŒ–é£ä¹¦æ°”æ³¡å›¾æ’ä»¶..."),initChart(),setupEventListeners(),!PLUGIN_CONFIG.appId||!PLUGIN_CONFIG.appSecret){e.n=2;break}return e.n=1,connectFeishu();case 1:e.n=3;break;case 2:console.warn("âš ï¸ æœªé…ç½®é£ä¹¦APIå‡­è¯ï¼Œä½¿ç”¨æ¼”ç¤ºæ•°æ®"),loadDemoData();case 3:initCalculator(),console.log("âœ… æ’ä»¶åˆå§‹åŒ–å®Œæˆ"),e.n=5;break;case 4:e.p=4,t=e.v,console.error("âŒ æ’ä»¶åˆå§‹åŒ–å¤±è´¥:",t),showError("æ’ä»¶åˆå§‹åŒ–å¤±è´¥: "+t.message);case 5:return e.a(2)}},e,null,[[0,4]])}))).apply(this,arguments)}function initChart(){var e=document.getElementById("chart");if(!e)throw new Error("æ‰¾ä¸åˆ°å›¾è¡¨å®¹å™¨");var t={title:{text:"é£ä¹¦å¤šç»´è¡¨æ ¼æ•°æ®æ°”æ³¡å›¾",left:"center",top:10},tooltip:{trigger:"item",formatter:function(e){return"".concat(e.name,"<br/>\n                        X: ").concat(e.value[0],"<br/>\n                        Y: ").concat(e.value[1],"<br/>\n                        å¤§å°: ").concat(e.value[2])}},xAxis:{name:"Xè½´",nameLocation:"middle",nameGap:30},yAxis:{name:"Yè½´",nameLocation:"middle",nameGap:30},series:[{type:"scatter",symbolSize:function(e){return Math.max(10,2*Math.sqrt(e[2]))},data:[],label:{show:!1,formatter:"{b}"},emphasis:{label:{show:!0}}}]};(chart=echarts.init(e,null,{renderer:"canvas",useDirtyRect:!1})).setOption(t),window.addEventListener("resize",function(){chart&&chart.resize()})}function setupEventListeners(){window.addEventListener("message",function(){var e=_asyncToGenerator(_regenerator().m(function e(t){var n,r;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,"updateData"!==(n="string"==typeof t.data?JSON.parse(t.data):t.data).type||!Array.isArray(n.payload)){e.n=2;break}return console.log("ğŸ“Š æ¥æ”¶åˆ°æ•°æ®æ›´æ–°:",n.payload),e.n=1,updateChartData(n.payload);case 1:e.n=3;break;case 2:"requestSync"===n.type&&t.source.postMessage({type:"currentData",payload:currentData},"*");case 3:e.n=5;break;case 4:e.p=4,r=e.v,console.error("æ¶ˆæ¯å¤„ç†å¤±è´¥:",r);case 5:return e.a(2)}},e,null,[[0,4]])}));return function(t){return e.apply(this,arguments)}}()),chart.on("click",function(e){"series"===e.componentType&&console.log("ç‚¹å‡»äº†æ°”æ³¡:",e.name,e.value)})}function connectFeishu(){return _connectFeishu.apply(this,arguments)}function _connectFeishu(){return(_connectFeishu=_asyncToGenerator(_regenerator().m(function e(){var t,n,r,a;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("ğŸ”— æ­£åœ¨è¿æ¥é£ä¹¦API..."),e.n=1,fetch("".concat(PLUGIN_CONFIG.apiBase,"/auth/v3/tenant_access_token/internal/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({app_id:PLUGIN_CONFIG.appId,app_secret:PLUGIN_CONFIG.appSecret})});case 1:if((t=e.v).ok){e.n=2;break}throw new Error("è·å–ä»¤ç‰Œå¤±è´¥: ".concat(t.status));case 2:return e.n=3,t.json();case 3:return n=e.v,r=n.tenant_access_token,console.log("âœ… é£ä¹¦APIè¿æ¥æˆåŠŸ"),feishuClient={accessToken:r,baseURL:PLUGIN_CONFIG.apiBase},e.n=4,loadFeishuData();case 4:e.n=6;break;case 5:e.p=5,a=e.v,console.error("é£ä¹¦APIè¿æ¥å¤±è´¥:",a),showError("é£ä¹¦APIè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®"),loadDemoData();case 6:return e.a(2)}},e,null,[[0,5]])}))).apply(this,arguments)}function loadFeishuData(){return _loadFeishuData.apply(this,arguments)}function _loadFeishuData(){return(_loadFeishuData=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:try{console.log("ğŸ“¥ æ­£åœ¨åŠ è½½é£ä¹¦æ•°æ®..."),console.log("âš ï¸ é£ä¹¦æ•°æ®åŠ è½½åŠŸèƒ½éœ€è¦é…ç½®å…·ä½“çš„è¡¨æ ¼ä¿¡æ¯"),loadDemoData()}catch(e){console.error("åŠ è½½é£ä¹¦æ•°æ®å¤±è´¥:",e),loadDemoData()}case 1:return e.a(2)}},e)}))).apply(this,arguments)}function loadDemoData(){console.log("ğŸ“Š åŠ è½½æ¼”ç¤ºæ•°æ®..."),updateChartData([[100,25,3e3,"æ™ºèƒ½æ‰‹æœº"],[80,20,2e3,"å¹³æ¿ç”µè„‘"],[120,15,3500,"ç¬”è®°æœ¬ç”µè„‘"],[60,35,1500,"æ™ºèƒ½æ‰‹è¡¨"],[90,30,2500,"æ™ºèƒ½éŸ³ç®±"],[75,22,1800,"è€³æœº"]])}function updateChartData(e){return _updateChartData.apply(this,arguments)}function _updateChartData(){return(_updateChartData=_asyncToGenerator(_regenerator().m(function e(t){var n,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:try{console.log("ğŸ”„ æ›´æ–°å›¾è¡¨æ•°æ®:",t),currentData=t,n=t.map(function(e){return{value:[e[0],e[1],e[2]],name:e[3]||"æ•°æ®ç‚¹".concat(t.indexOf(e)+1)}}),r={series:[{data:n}]},chart.setOption(r,!0),console.log("âœ… å›¾è¡¨æ•°æ®æ›´æ–°å®Œæˆ")}catch(e){console.error("æ›´æ–°å›¾è¡¨æ•°æ®å¤±è´¥:",e),showError("æ›´æ–°å›¾è¡¨æ•°æ®å¤±è´¥: "+e.message)}case 1:return e.a(2)}},e)}))).apply(this,arguments)}function initCalculator(){console.log("ğŸ§® åˆå§‹åŒ–è®¡ç®—å™¨..."),window.sendCalcResult=function(){var expr=document.getElementById("calcExpr").value;if(expr)try{console.log("ğŸ“¤ å‘é€è®¡ç®—ç»“æœ:",expr),window.parent!==window&&window.parent.postMessage({type:"calcResult",payload:{expression:expr,result:eval(expr),timestamp:(new Date).toISOString()}},"*"),alert("è®¡ç®—ç»“æœå·²å‘é€: "+expr)}catch(e){console.error("è®¡ç®—å¤±è´¥:",e),alert("è®¡ç®—å¤±è´¥: "+e.message)}}}function showError(e){console.error("âŒ",e);var t=document.createElement("div");t.style.cssText="\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: #ff4444;\n        color: white;\n        padding: 15px;\n        border-radius: 5px;\n        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n        z-index: 1000;\n        max-width: 300px;\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(function(){t.parentNode&&t.parentNode.removeChild(t)},5e3)}function showSuccess(e){console.log("âœ…",e)}function exportChart(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"png";try{if(!chart)throw new Error("å›¾è¡¨æœªåˆå§‹åŒ–");var t=chart.getDataURL({type:e,pixelRatio:2,backgroundColor:"#fff"}),n=document.createElement("a");n.download="æ°”æ³¡å›¾_".concat((new Date).toISOString().slice(0,10),".").concat(e),n.href=t,n.click(),showSuccess("å›¾è¡¨å¯¼å‡ºæˆåŠŸ")}catch(e){showError("å›¾è¡¨å¯¼å‡ºå¤±è´¥: "+e.message)}}function getCurrentData(){return currentData}function setFeishuConfig(e){Object.assign(PLUGIN_CONFIG,e),console.log("é£ä¹¦é…ç½®å·²æ›´æ–°:",PLUGIN_CONFIG)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initPlugin):initPlugin(),window.FeishuBubbleChartPlugin={init:initPlugin,updateData:updateChartData,getData:getCurrentData,exportChart,setConfig:setFeishuConfig}})();