(()=>{"use strict";var e={56:(e,n,t)=>{e.exports=function(e){var n=t.nc;n&&e.setAttribute("nonce",n)}},72:e=>{var n=[];function t(e){for(var t=-1,a=0;a<n.length;a++)if(n[a].identifier===e){t=a;break}return t}function a(e,a){for(var r={},o=[],s=0;s<e.length;s++){var l=e[s],d=a.base?l[0]+a.base:l[0],c=r[d]||0,h="".concat(d," ").concat(c);r[d]=c+1;var p=t(h),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)n[p].references++,n[p].updater(u);else{var g=i(u,a);a.byIndex=s,n.splice(s,0,{identifier:h,updater:g,references:1})}o.push(h)}return o}function i(e,n){var t=n.domAPI(n);return t.update(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap&&n.supports===e.supports&&n.layer===e.layer)return;t.update(e=n)}else t.remove()}}e.exports=function(e,i){var r=a(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<r.length;o++){var s=t(r[o]);n[s].references--}for(var l=a(e,i),d=0;d<r.length;d++){var c=t(r[d]);0===n[c].references&&(n[c].updater(),n.splice(c,1))}r=l}}},113:e=>{e.exports=function(e,n){if(n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}},314:e=>{e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t="",a=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),a&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),a&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t}).join("")},n.i=function(e,t,a,i,r){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(a)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(o[l]=!0)}for(var d=0;d<e.length;d++){var c=[].concat(e[d]);a&&o[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=r),t&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=t):c[2]=t),i&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=i):c[4]="".concat(i)),n.push(c))}},n}},365:(e,n,t)=>{t.d(n,{A:()=>s});var a=t(601),i=t.n(a),r=t(314),o=t.n(r)()(i());o.push([e.id,"/* é£ä¹¦æ•°æ®å¯è§†åŒ–æ’ä»¶æ ·å¼æ–‡ä»¶ */\n\n/* åŸºç¡€æ ·å¼é‡ç½® */\n* {\n    box-sizing: border-box;\n}\n\nbody {\n    margin: 0;\n    padding: 0;\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    min-height: 100vh;\n}\n\n/* æ’ä»¶å®¹å™¨ */\n.plugin-container {\n    background: rgba(255, 255, 255, 0.95);\n    backdrop-filter: blur(10px);\n    border-radius: 20px;\n    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);\n    margin: 20px auto;\n    max-width: 1200px;\n    min-height: 80vh;\n    animation: fadeIn 0.8s ease-in;\n}\n\n/* å¤´éƒ¨æ ·å¼ */\n.header {\n    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);\n    color: white;\n    padding: 30px;\n    border-radius: 20px 20px 0 0;\n    text-align: center;\n}\n\n.header h1 {\n    margin: 0;\n    font-size: 2.5em;\n    font-weight: 300;\n    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\n.header p {\n    margin: 10px 0 0 0;\n    opacity: 0.9;\n    font-size: 1.1em;\n}\n\n/* ä¸»å†…å®¹åŒºåŸŸ */\n.main-content {\n    padding: 30px;\n}\n\n/* å¡ç‰‡æ ·å¼ */\n.card {\n    border: none;\n    border-radius: 15px;\n    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);\n    transition: transform 0.3s ease, box-shadow 0.3s ease;\n    animation: slideIn 0.6s ease-out;\n}\n\n.card:hover {\n    transform: translateY(-5px);\n    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);\n}\n\n.card-header {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    border-radius: 15px 15px 0 0 !important;\n    padding: 20px;\n}\n\n.card-body {\n    padding: 25px;\n}\n\n/* è¡¨æ ¼ä¿¡æ¯å¡ç‰‡ */\n.table-info-card {\n    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);\n    border-radius: 15px;\n    padding: 20px;\n    margin-bottom: 20px;\n    border: 1px solid rgba(102, 126, 234, 0.1);\n}\n\n.table-info-card h6 {\n    color: #495057;\n    margin-bottom: 15px;\n    font-weight: 600;\n}\n\n.info-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 15px;\n    margin-top: 15px;\n}\n\n.info-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 12px 15px;\n    background: white;\n    border-radius: 10px;\n    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);\n    border-left: 4px solid #667eea;\n}\n\n.info-label {\n    font-weight: 600;\n    color: #495057;\n    font-size: 0.9em;\n}\n\n.info-value {\n    color: #667eea;\n    font-weight: 500;\n    font-size: 0.9em;\n}\n\n/* è¡¨å•æ§ä»¶æ ·å¼ */\n.form-control,\n.form-select {\n    border-radius: 10px;\n    border: 2px solid #e9ecef;\n    transition: all 0.3s ease;\n    padding: 10px 15px;\n    font-size: 0.95em;\n}\n\n.form-control:focus,\n.form-select:focus {\n    border-color: #667eea;\n    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);\n}\n\n.form-label {\n    font-weight: 600;\n    color: #495057;\n    margin-bottom: 8px;\n    font-size: 0.9em;\n}\n\n/* æŒ‰é’®æ ·å¼ */\n.btn {\n    border-radius: 25px;\n    padding: 12px 25px;\n    font-weight: 500;\n    transition: all 0.3s ease;\n    border: none;\n    text-transform: none;\n    letter-spacing: 0.5px;\n}\n\n.btn-primary {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);\n}\n\n.btn-primary:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);\n}\n\n.btn-outline-secondary {\n    border: 2px solid #6c757d;\n    color: #6c757d;\n}\n\n.btn-outline-secondary:hover {\n    background: #6c757d;\n    color: white;\n    transform: translateY(-2px);\n}\n\n.btn-outline-warning {\n    border: 2px solid #ffc107;\n    color: #ffc107;\n}\n\n.btn-outline-warning:hover {\n    background: #ffc107;\n    color: #212529;\n    transform: translateY(-2px);\n}\n\n.btn-outline-primary {\n    border: 2px solid #667eea;\n    color: #667eea;\n}\n\n.btn-outline-primary:hover {\n    background: #667eea;\n    color: white;\n    transform: translateY(-2px);\n}\n\n/* å­—æ®µç»Ÿè®¡å¾½ç«  */\n.field-statistics {\n    display: flex;\n    gap: 10px;\n    flex-wrap: wrap;\n    margin-bottom: 15px;\n}\n\n.badge {\n    font-size: 0.8em;\n    padding: 8px 12px;\n    border-radius: 20px;\n    font-weight: 500;\n}\n\n.field-recommendations {\n    margin-top: 15px;\n    padding: 10px;\n    background: rgba(102, 126, 234, 0.05);\n    border-radius: 8px;\n    border-left: 3px solid #667eea;\n}\n\n/* å›¾è¡¨å®¹å™¨ */\n.chart-container {\n    background: white;\n    border-radius: 15px;\n    padding: 20px;\n    margin-top: 20px;\n    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);\n    min-height: 400px;\n    position: relative;\n}\n\n.chart-placeholder {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    height: 300px;\n    border: 2px dashed #dee2e6;\n    border-radius: 10px;\n    color: #6c757d;\n    font-size: 1.1em;\n    text-align: center;\n    background: #f8f9fa;\n}\n\n.chart-placeholder i {\n    font-size: 4em;\n    opacity: 0.3;\n    margin-bottom: 20px;\n}\n\n#chartCanvas {\n    display: none;\n    background: white;\n    border-radius: 10px;\n    padding: 15px;\n}\n\n#myChart {\n    max-width: 100%;\n    height: auto;\n}\n\n/* ç‰¹æ€§å¡ç‰‡ */\n.feature-card {\n    text-align: center;\n    padding: 25px;\n    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);\n    border-radius: 15px;\n    height: 100%;\n    transition: transform 0.3s ease;\n    border: 1px solid rgba(102, 126, 234, 0.1);\n}\n\n.feature-card:hover {\n    transform: translateY(-3px);\n    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);\n}\n\n.feature-icon {\n    font-size: 3em;\n    margin-bottom: 15px;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    background-clip: text;\n}\n\n.feature-card h6 {\n    color: #495057;\n    margin-bottom: 8px;\n    font-weight: 600;\n}\n\n.feature-card small {\n    color: #6c757d;\n    font-size: 0.85em;\n    line-height: 1.4;\n}\n\n/* åŠ è½½é®ç½© */\n.loading-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.7);\n    display: none;\n    justify-content: center;\n    align-items: center;\n    z-index: 9999;\n    backdrop-filter: blur(5px);\n}\n\n.loading-content {\n    background: white;\n    padding: 30px;\n    border-radius: 15px;\n    text-align: center;\n    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n    max-width: 300px;\n    width: 90%;\n}\n\n.spinner-border {\n    width: 3rem;\n    height: 3rem;\n    border-width: 0.3em;\n    color: #667eea;\n}\n\n.loading-content p {\n    margin-top: 15px;\n    margin-bottom: 0;\n    color: #495057;\n    font-weight: 500;\n}\n\n/* æ¨¡æ€æ¡†æ ·å¼ */\n.modal-content {\n    border-radius: 15px;\n    border: none;\n    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n}\n\n.modal-header {\n    border-radius: 15px 15px 0 0;\n    border-bottom: none;\n    padding: 20px 25px;\n}\n\n.modal-body {\n    padding: 25px;\n}\n\n.modal-footer {\n    border-top: 1px solid #e9ecef;\n    padding: 20px 25px;\n}\n\n/* Toast æ ·å¼ */\n.toast {\n    border-radius: 10px;\n    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);\n    border: none;\n}\n\n.toast-header {\n    border-radius: 10px 10px 0 0;\n    border-bottom: none;\n    padding: 15px 20px;\n}\n\n/* è­¦å‘Šæ ·å¼ */\n.alert {\n    border-radius: 10px;\n    border: none;\n    padding: 15px 20px;\n    margin-bottom: 20px;\n}\n\n.alert-info {\n    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);\n    color: #0277bd;\n    border-left: 4px solid #2196f3;\n}\n\n/* åŠ¨ç”»æ•ˆæœ */\n@keyframes fadeIn {\n    from {\n        opacity: 0;\n        transform: translateY(20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n@keyframes slideIn {\n    from {\n        transform: translateX(-30px);\n        opacity: 0;\n    }\n    to {\n        transform: translateX(0);\n        opacity: 1;\n    }\n}\n\n@keyframes pulse {\n    0% {\n        transform: scale(1);\n    }\n    50% {\n        transform: scale(1.05);\n    }\n    100% {\n        transform: scale(1);\n    }\n}\n\n/* å“åº”å¼è®¾è®¡ */\n@media (max-width: 768px) {\n    .plugin-container {\n        margin: 10px;\n        border-radius: 15px;\n    }\n    \n    .header {\n        padding: 20px;\n        border-radius: 15px 15px 0 0;\n    }\n    \n    .header h1 {\n        font-size: 2em;\n    }\n    \n    .main-content {\n        padding: 20px;\n    }\n    \n    .info-grid {\n        grid-template-columns: 1fr;\n        gap: 10px;\n    }\n    \n    .info-item {\n        padding: 10px;\n    }\n    \n    .field-statistics {\n        flex-direction: column;\n        align-items: stretch;\n    }\n    \n    .badge {\n        text-align: center;\n        margin-bottom: 5px;\n    }\n    \n    .btn {\n        padding: 10px 20px;\n        font-size: 0.9em;\n    }\n    \n    .chart-placeholder {\n        height: 250px;\n        padding: 20px;\n    }\n    \n    .chart-placeholder i {\n        font-size: 3em;\n    }\n}\n\n@media (max-width: 480px) {\n    .header h1 {\n        font-size: 1.5em;\n    }\n    \n    .header p {\n        font-size: 1em;\n    }\n    \n    .main-content {\n        padding: 15px;\n    }\n    \n    .card-body {\n        padding: 20px;\n    }\n    \n    .feature-card {\n        padding: 20px;\n    }\n    \n    .feature-icon {\n        font-size: 2.5em;\n    }\n}\n\n/* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */\n::-webkit-scrollbar {\n    width: 8px;\n}\n\n::-webkit-scrollbar-track {\n    background: #f1f1f1;\n    border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n    background: linear-gradient(135deg, #5a6fd8 0%, #6a3f9e 100%);\n}\n\n/* å·¥å…·æç¤ºå¢å¼º */\n.tooltip {\n    font-size: 0.85em;\n}\n\n/* é€‰æ‹©æ¡†å¢å¼º */\n.form-select {\n    cursor: pointer;\n}\n\n.form-select option {\n    padding: 8px;\n}\n\n/* æŒ‰é’®ç»„ */\n.btn-group .btn {\n    border-radius: 0;\n}\n\n.btn-group .btn:first-child {\n    border-radius: 25px 0 0 25px;\n}\n\n.btn-group .btn:last-child {\n    border-radius: 0 25px 25px 0;\n}\n\n/* çŠ¶æ€æŒ‡ç¤ºå™¨ */\n.status-indicator {\n    display: inline-block;\n    width: 8px;\n    height: 8px;\n    border-radius: 50%;\n    margin-right: 8px;\n}\n\n.status-online {\n    background: #28a745;\n    animation: pulse 2s infinite;\n}\n\n.status-offline {\n    background: #dc3545;\n}\n\n.status-syncing {\n    background: #ffc107;\n    animation: pulse 1s infinite;\n}",""]);const s=o},540:e=>{e.exports=function(e){var n=document.createElement("style");return e.setAttributes(n,e.attributes),e.insert(n,e.options),n}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var n={};e.exports=function(e,t){var a=function(e){if(void 0===n[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}n[e]=t}return n[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=e.insertStyleElement(e);return{update:function(t){!function(e,n,t){var a="";t.supports&&(a+="@supports (".concat(t.supports,") {")),t.media&&(a+="@media ".concat(t.media," {"));var i=void 0!==t.layer;i&&(a+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),a+=t.css,i&&(a+="}"),t.media&&(a+="}"),t.supports&&(a+="}");var r=t.sourceMap;r&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),n.styleTagTransform(a,e,n.options)}(n,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)}}}}},n={};function t(a){var i=n[a];if(void 0!==i)return i.exports;var r=n[a]={id:a,exports:{}};return e[a](r,r.exports,t),r.exports}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.nc=void 0;var a=t(72),i=t.n(a),r=t(825),o=t.n(r),s=t(659),l=t.n(s),d=t(56),c=t.n(d),h=t(540),p=t.n(h),u=t(113),g=t.n(u),f=t(365),m={};m.styleTagTransform=g(),m.setAttributes=c(),m.insert=l().bind(null,"head"),m.domAPI=o(),m.insertStyleElement=p(),i()(f.A,m),f.A&&f.A.locals&&f.A.locals;class b{constructor(){this.table=null,this.fields=[],this.records=[],this.isInitialized=!1}async initialize(){try{if(console.log("ğŸ”Œ åˆå§‹åŒ–é£ä¹¦æ’ä»¶é›†æˆ..."),await this.waitForFeishuEnvironment(),this.table=await window.bitable.getActiveTable(),!this.table)throw new Error("æ— æ³•è·å–å½“å‰æ´»åŠ¨è¡¨æ ¼");this.fields=await this.table.getFieldMetaList(),this.records=await this.table.getRecordList(),this.isInitialized=!0,console.log("âœ… é£ä¹¦æ’ä»¶é›†æˆåˆå§‹åŒ–æˆåŠŸ"),console.log(`ğŸ“Š è¡¨æ ¼ä¿¡æ¯: ${this.fields.length} ä¸ªå­—æ®µ, ${this.records.length} æ¡è®°å½•`)}catch(e){throw console.error("âŒ é£ä¹¦æ’ä»¶é›†æˆåˆå§‹åŒ–å¤±è´¥:",e),e}}async waitForFeishuEnvironment(){return new Promise((e,n)=>{let t=0;const a=()=>{t++,window.bitable&&window.bitable.getActiveTable&&"function"==typeof window.bitable.getActiveTable?(console.log("âœ… é£ä¹¦ç¯å¢ƒæ£€æµ‹æˆåŠŸ"),e()):t>=100?n(new Error("é£ä¹¦ç¯å¢ƒåŠ è½½è¶…æ—¶ï¼Œè¯·ç¡®ä¿åœ¨é£ä¹¦å¤šç»´è¡¨æ ¼ä¸­è¿è¡Œ")):setTimeout(a,200)};a()})}getTableInfo(){if(!this.isInitialized)throw new Error("æ’ä»¶å°šæœªåˆå§‹åŒ–");return{id:this.table.id,name:this.table.name||"æœªå‘½åè¡¨æ ¼",recordCount:this.records.length,fieldCount:this.fields.length,lastModified:(new Date).toISOString()}}getFields(){if(!this.isInitialized)throw new Error("æ’ä»¶å°šæœªåˆå§‹åŒ–");return this.fields.map(e=>({id:e.id,name:e.name,type:this.mapFieldType(e.type),description:e.description||"",isPrimary:e.isPrimary||!1}))}getRecords(){if(!this.isInitialized)throw new Error("æ’ä»¶å°šæœªåˆå§‹åŒ–");return this.records.map(e=>({id:e.id,fields:e.fields||{},createdTime:e.createdTime||(new Date).toISOString(),lastModifiedTime:e.lastModifiedTime||(new Date).toISOString()}))}getTableData(){return{tableInfo:this.getTableInfo(),fields:this.getFields(),records:this.getRecords()}}mapFieldType(e){return{1:"text",2:"number",3:"singleSelect",4:"multiselect",5:"date",7:"checkbox",11:"phone",13:"url",15:"formula",17:"currency",18:"percent",20:"datetime",21:"email",22:"barcode",23:"attachment"}[e]||"text"}async getFieldValues(e){if(!this.isInitialized)throw new Error("æ’ä»¶å°šæœªåˆå§‹åŒ–");try{const n=this.table.getField(e),t=[];for(const e of this.records){const a=await n.getValue(e.id);t.push({recordId:e.id,value:a})}return t}catch(n){throw console.error(`è·å–å­—æ®µ ${e} å€¼å¤±è´¥:`,n),n}}async updateRecord(e,n){if(!this.isInitialized)throw new Error("æ’ä»¶å°šæœªåˆå§‹åŒ–");try{await this.table.setRecord(e,n),console.log(`âœ… è®°å½• ${e} æ›´æ–°æˆåŠŸ`),this.records=await this.table.getRecordList()}catch(e){throw console.error("æ›´æ–°è®°å½•å¤±è´¥:",e),e}}getTableStatistics(){if(!this.isInitialized)throw new Error("æ’ä»¶å°šæœªåˆå§‹åŒ–");const e=this.getFields(),n=this.getRecords(),t={totalRecords:n.length,totalFields:e.length,fieldTypes:{},emptyRecords:0,lastActivity:null};return e.forEach(e=>{t.fieldTypes[e.type]=(t.fieldTypes[e.type]||0)+1}),n.forEach(e=>{Object.values(e.fields).some(e=>null!=e&&""!==e)||t.emptyRecords++,(!t.lastActivity||e.lastModifiedTime>t.lastActivity)&&(t.lastActivity=e.lastModifiedTime)}),t}addEventListener(e,n){if(!this.table)throw new Error("è¡¨æ ¼å°šæœªåˆå§‹åŒ–");"recordChange"===e?this.table.on("recordChange",n):"fieldChange"===e&&this.table.on("fieldChange",n)}removeEventListener(e,n){this.table&&("recordChange"===e?this.table.off("recordChange",n):"fieldChange"===e&&this.table.off("fieldChange",n))}}class x{constructor(){this.charts=new Map,this.currentChart=null,this.canvas=null,this.ctx=null}async generate(e){try{console.log("ğŸ“Š å¼€å§‹ç”Ÿæˆå›¾è¡¨...",e),this.setupCanvas(),this.currentChart&&this.currentChart.destroy();const n=this.createChartConfig(e);this.currentChart=new Chart(this.ctx,n),this.showChartContainer(),console.log("âœ… å›¾è¡¨ç”ŸæˆæˆåŠŸ")}catch(e){throw console.error("âŒ å›¾è¡¨ç”Ÿæˆå¤±è´¥:",e),new Error(`å›¾è¡¨ç”Ÿæˆå¤±è´¥: ${e.message}`)}}setupCanvas(){if(this.canvas=document.getElementById("myChart"),!this.canvas){const e=document.getElementById("chartCanvas");if(!e)throw new Error("æ‰¾ä¸åˆ°å›¾è¡¨å®¹å™¨");this.canvas=document.createElement("canvas"),this.canvas.id="myChart",e.appendChild(this.canvas)}this.ctx=this.canvas.getContext("2d");const e=this.canvas.parentElement;this.canvas.width=e.offsetWidth,this.canvas.height=Math.max(400,e.offsetHeight-20)}createChartConfig(e){const{type:n,data:t}=e,a={type:n,data:t,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:20,font:{size:12,family:"Segoe UI, Tahoma, Geneva, Verdana, sans-serif"}}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#fff",bodyColor:"#fff",borderColor:"#667eea",borderWidth:1,cornerRadius:8,displayColors:!0}},scales:this.getScalesConfig(n,t),animation:{duration:1e3,easing:"easeInOutQuart"},interaction:{intersect:!1,mode:"index"}}};return this.enhanceConfigForType(a,n,t)}getScalesConfig(e,n){return["pie","doughnut","polarArea","radar"].includes(e)?{}:{x:{grid:{color:"rgba(0, 0, 0, 0.1)",lineWidth:1},ticks:{font:{size:11,family:"Segoe UI, Tahoma, Geneva, Verdana, sans-serif"},color:"#666"}},y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)",lineWidth:1},ticks:{font:{size:11,family:"Segoe UI, Tahoma, Geneva, Verdana, sans-serif"},color:"#666"}}}}enhanceConfigForType(e,n,t){switch(n){case"bar":return this.enhanceBarConfig(e,t);case"line":return this.enhanceLineConfig(e,t);case"pie":return this.enhancePieConfig(e,t);case"scatter":return this.enhanceScatterConfig(e,t);case"bubble":return this.enhanceBubbleConfig(e,t);default:return e}}enhanceBarConfig(e,n){return e.options.plugins.title={display:!0,text:"æŸ±çŠ¶å›¾åˆ†æ",font:{size:16,weight:"bold"},padding:20},e.options.scales.x.ticks.maxRotation=45,e.options.scales.x.ticks.minRotation=0,e}enhanceLineConfig(e,n){return e.options.plugins.title={display:!0,text:"è¶‹åŠ¿åˆ†æ",font:{size:16,weight:"bold"},padding:20},e.options.elements={line:{tension:.4}},e}enhancePieConfig(e,n){return e.options.plugins.title={display:!0,text:"å æ¯”åˆ†æ",font:{size:16,weight:"bold"},padding:20},e.options.plugins.legend.position="right",e.options.plugins.legend.labels.padding=20,e}enhanceScatterConfig(e,n){return e.options.plugins.title={display:!0,text:"æ•£ç‚¹åˆ†æ",font:{size:16,weight:"bold"},padding:20},e.options.scales.x.type="linear",e.options.scales.x.position="bottom",e}enhanceBubbleConfig(e,n){return e.options.plugins.title={display:!0,text:"æ°”æ³¡åˆ†æ",font:{size:16,weight:"bold"},padding:20},e.options.scales.x.type="linear",e.options.scales.x.position="bottom",e}showChartContainer(){const e=document.querySelector(".chart-placeholder"),n=document.getElementById("chartCanvas");e&&(e.style.display="none"),n&&(n.style.display="block");const t=document.getElementById("exportChart");t&&(t.style.display="inline-block")}exportChart(e="png"){if(!this.canvas)throw new Error("æ²¡æœ‰å¯å¯¼å‡ºçš„å›¾è¡¨");try{let n,t;switch(e){case"png":n=this.canvas.toDataURL("image/png"),t=`chart_${Date.now()}.png`;break;case"jpg":case"jpeg":n=this.canvas.toDataURL("image/jpeg",.9),t=`chart_${Date.now()}.jpg`;break;case"svg":throw new Error("SVG å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­");default:throw new Error("ä¸æ”¯æŒçš„å¯¼å‡ºæ ¼å¼")}const a=document.createElement("a");a.download=t,a.href=n,a.click(),console.log(`âœ… å›¾è¡¨å·²å¯¼å‡ºä¸º ${t}`)}catch(e){throw console.error("âŒ å›¾è¡¨å¯¼å‡ºå¤±è´¥:",e),e}}updateChart(e){if(!this.currentChart)throw new Error("æ²¡æœ‰æ´»åŠ¨çš„å›¾è¡¨å¯ä»¥æ›´æ–°");try{this.currentChart.data=e,this.currentChart.update("active"),console.log("âœ… å›¾è¡¨æ•°æ®å·²æ›´æ–°")}catch(e){throw console.error("âŒ å›¾è¡¨æ›´æ–°å¤±è´¥:",e),e}}destroyChart(){this.currentChart&&(this.currentChart.destroy(),this.currentChart=null),this.canvas&&this.canvas.parentNode&&(this.canvas.parentNode.removeChild(this.canvas),this.canvas=null,this.ctx=null);const e=document.querySelector(".chart-placeholder"),n=document.getElementById("chartCanvas");e&&(e.style.display="flex"),n&&(n.style.display="none");const t=document.getElementById("exportChart");t&&(t.style.display="none"),console.log("âœ… å›¾è¡¨å·²é”€æ¯")}getCurrentChart(){return this.currentChart}getChartData(){return this.currentChart?this.currentChart.data:null}resizeChart(){this.currentChart&&this.currentChart.resize()}}class y{constructor(){this.fieldRecommendations=null,this.analysisCache=new Map}analyze(e){if(console.log("ğŸ” å¼€å§‹æ™ºèƒ½å­—æ®µåˆ†æ...",e),!e||0===e.length)throw new Error("æ²¡æœ‰å¯ç”¨çš„å­—æ®µè¿›è¡Œåˆ†æ");const n=this.generateCacheKey(e);if(this.analysisCache.has(n))return console.log("ğŸ“Š ä½¿ç”¨ç¼“å­˜çš„åˆ†æç»“æœ"),this.analysisCache.get(n);try{const t={fields:e,recommendations:this.generateRecommendations(e),statistics:this.generateStatistics(e),insights:this.generateInsights(e),timestamp:(new Date).toISOString()};return this.analysisCache.set(n,t.recommendations),console.log("âœ… æ™ºèƒ½å­—æ®µåˆ†æå®Œæˆ"),t.recommendations}catch(e){throw console.error("âŒ å­—æ®µåˆ†æå¤±è´¥:",e),new Error(`å­—æ®µåˆ†æå¤±è´¥: ${e.message}`)}}generateRecommendations(e){const n={xAxis:null,yAxis:null,group:null,color:null,size:null,confidence:0,reasoning:[]},t=this.categorizeFields(e);return n.xAxis=this.findBestXAxisField(t),n.xAxis&&n.reasoning.push(`Xè½´: é€‰æ‹© ${n.xAxis.name} (${this.getFieldTypeLabel(n.xAxis.type)})`),n.yAxis=this.findBestYAxisField(t),n.yAxis&&n.reasoning.push(`Yè½´: é€‰æ‹© ${n.yAxis.name} (${this.getFieldTypeLabel(n.yAxis.type)})`),n.group=this.findBestGroupField(t),n.group&&n.reasoning.push(`åˆ†ç»„: é€‰æ‹© ${n.group.name} (${this.getFieldTypeLabel(n.group.type)})`),n.color=this.findBestColorField(t),n.size=this.findBestSizeField(t),n.confidence=this.calculateConfidence(n,t),n}categorizeFields(e){const n={text:[],numeric:[],date:[],categorical:[],other:[]};return e.forEach(e=>{switch(e.type){case"text":case"select":case"multiselect":n.text.push(e),"select"!==e.type&&"multiselect"!==e.type||n.categorical.push(e);break;case"number":case"currency":case"percent":case"formula":n.numeric.push(e);break;case"date":case"datetime":n.date.push(e);break;default:n.other.push(e)}}),n}findBestXAxisField(e){return e.date.length>0?e.date[0]:e.text.length>0?e.text[0]:e.categorical.length>0?e.categorical[0]:e.other[0]||null}findBestYAxisField(e){return e.numeric.length>0?e.numeric[0]:null}findBestGroupField(e){return[...e.categorical,...e.text][0]||null}findBestColorField(e){return this.findBestGroupField(e)}findBestSizeField(e){return this.findBestYAxisField(e)}calculateConfidence(e,n){let t=0,a=0;return e.xAxis&&(a++,(n.date.includes(e.xAxis)||n.text.includes(e.xAxis))&&(t+=1)),e.yAxis&&(a++,n.numeric.includes(e.yAxis)&&(t+=1)),e.group&&(a++,n.categorical.includes(e.group)?t+=.8:n.text.includes(e.group)&&(t+=.6)),a>0?t/a*100:0}generateStatistics(e){const n={totalFields:e.length,typeDistribution:{},hasDates:!1,hasNumbers:!1,hasText:!1,hasCategorical:!1};return e.forEach(e=>{switch(n.typeDistribution[e.type]=(n.typeDistribution[e.type]||0)+1,e.type){case"date":case"datetime":n.hasDates=!0;break;case"number":case"currency":case"percent":case"formula":n.hasNumbers=!0;break;case"text":n.hasText=!0;break;case"select":case"multiselect":n.hasCategorical=!0}}),n}generateInsights(e){const n=[],t=this.generateStatistics(e);return t.hasDates&&t.hasNumbers&&n.push("ğŸ’¡ æ£€æµ‹åˆ°æ—¶é—´åºåˆ—æ•°æ®ï¼Œé€‚åˆç”Ÿæˆè¶‹åŠ¿å›¾è¡¨"),t.hasCategorical&&t.hasNumbers&&n.push("ğŸ’¡ æ£€æµ‹åˆ°åˆ†ç±»æ•°æ®ï¼Œé€‚åˆç”Ÿæˆåˆ†ç»„å¯¹æ¯”å›¾è¡¨"),t.typeDistribution.number>=2&&n.push("ğŸ’¡ æ£€æµ‹åˆ°å¤šä¸ªæ•°å€¼å­—æ®µï¼Œé€‚åˆç”Ÿæˆæ•£ç‚¹å›¾æˆ–æ°”æ³¡å›¾"),t.hasText&&!t.hasNumbers&&n.push("ğŸ’¡ ä¸»è¦åŒ…å«æ–‡æœ¬æ•°æ®ï¼Œå»ºè®®ç”Ÿæˆè¯äº‘æˆ–åˆ†ç±»ç»Ÿè®¡"),n}getRecommendedXAxis(){return this.fieldRecommendations?.xAxis||null}getRecommendedYAxis(){return this.fieldRecommendations?.yAxis||null}getRecommendedGroupField(){return this.fieldRecommendations?.group||null}getRecommendedColorField(){return this.fieldRecommendations?.color||null}getRecommendedSizeField(){return this.fieldRecommendations?.size||null}getConfidence(){return this.fieldRecommendations?.confidence||0}getReasoning(){return this.fieldRecommendations?.reasoning||[]}generateCacheKey(e){return e.map(e=>`${e.id}:${e.type}`).join("|")}getFieldTypeLabel(e){return{text:"æ–‡æœ¬",number:"æ•°å€¼",currency:"è´§å¸",percent:"ç™¾åˆ†æ¯”",date:"æ—¥æœŸ",datetime:"æ—¥æœŸæ—¶é—´",checkbox:"å¤é€‰æ¡†",select:"å•é€‰",multiselect:"å¤šé€‰",url:"é“¾æ¥",email:"é‚®ç®±",phone:"ç”µè¯",formula:"å…¬å¼",barcode:"æ¡å½¢ç ",attachment:"é™„ä»¶"}[e]||e}clearCache(){this.analysisCache.clear(),this.fieldRecommendations=null}getCacheSize(){return this.analysisCache.size}analyzeFieldDistribution(e,n){if(!n||0===n.length)return null;const t={field:e,totalValues:0,uniqueValues:new Set,nullCount:0,valueCounts:{},minValue:null,maxValue:null,avgValue:null};if(n.forEach(n=>{const a=n.fields[e.id];if(t.totalValues++,null==a||""===a)t.nullCount++;else{t.uniqueValues.add(a);const n=String(a);if(t.valueCounts[n]=(t.valueCounts[n]||0)+1,"number"===e.type&&!isNaN(a)){const e=Number(a);(null===t.minValue||e<t.minValue)&&(t.minValue=e),(null===t.maxValue||e>t.maxValue)&&(t.maxValue=e)}}}),"number"===e.type&&t.totalValues>t.nullCount){const e=Object.keys(t.valueCounts).map(e=>Number(e)).filter(e=>!isNaN(e));e.length>0&&(t.avgValue=e.reduce((e,n)=>e+n,0)/e.length)}return t.uniqueValues=Array.from(t.uniqueValues),t}}window.feishuPlugin=new class{constructor(){console.log("ğŸš€ é£ä¹¦æ•°æ®å¯è§†åŒ–æ’ä»¶å®ä¾‹åŒ–"),this.integration=new b,this.chartGenerator=new x,this.fieldAnalyzer=new y,this.isInitialized=!1,this.currentChart=null}async initialize(){try{console.log("ğŸš€ å¼€å§‹åˆå§‹åŒ–æ’ä»¶..."),this.showLoading("æ­£åœ¨æ£€æµ‹é£ä¹¦ç¯å¢ƒ..."),await this.waitForFeishuEnvironment(),await this.integration.initialize();const e=this.integration.getTableData();await this.updateUI(e),await this.performSmartAnalysis(),this.isInitialized=!0,this.hideLoading(),console.log("âœ… æ’ä»¶åˆå§‹åŒ–å®Œæˆ")}catch(e){console.error("âŒ æ’ä»¶åˆå§‹åŒ–å¤±è´¥:",e),this.hideLoading(),this.handleInitializationError(e)}}async waitForFeishuEnvironment(){return new Promise((e,n)=>{let t=0;const a=()=>{t++,window.bitable&&window.bitable.getActiveTable&&"function"==typeof window.bitable.getActiveTable?(console.log("âœ… é£ä¹¦ç¯å¢ƒæ£€æµ‹æˆåŠŸ"),e()):t>=100?n(new Error("é£ä¹¦ç¯å¢ƒåŠ è½½è¶…æ—¶")):setTimeout(a,200)};a()})}async updateUI(e){console.log("ğŸ¨ æ›´æ–°UIç•Œé¢..."),this.displayTableInfo(e.tableInfo),this.populateFieldSelectors(e.fields),this.displayFieldRecognition(e.fields),console.log("âœ… UIæ›´æ–°å®Œæˆ")}async performSmartAnalysis(){console.log("ğŸ§  æ‰§è¡Œæ™ºèƒ½å­—æ®µåˆ†æ...");const e=this.integration.getFields(),n=this.fieldAnalyzer.analyze(e);console.log("ğŸ“Š æ™ºèƒ½åˆ†æç»“æœ:",n),this.autoSelectFields(n),n.xAxis&&n.yAxis&&setTimeout(()=>{this.generateChart()},1e3)}displayTableInfo(e){const n=document.getElementById("table-info");n&&e&&(n.innerHTML=`\n                <div class="table-info-card">\n                    <h6><i class="bi bi-table"></i> å½“å‰è¡¨æ ¼ä¿¡æ¯</h6>\n                    <div class="info-grid">\n                        <div class="info-item">\n                            <span class="info-label">è¡¨æ ¼åç§°:</span>\n                            <span class="info-value">${e.name}</span>\n                        </div>\n                        <div class="info-item">\n                            <span class="info-label">è®°å½•æ•°é‡:</span>\n                            <span class="info-value">${e.recordCount} æ¡</span>\n                        </div>\n                        <div class="info-item">\n                            <span class="info-label">å­—æ®µæ•°é‡:</span>\n                            <span class="info-value">${e.fieldCount} ä¸ª</span>\n                        </div>\n                        <div class="info-item">\n                            <span class="info-label">æœ€åæ›´æ–°:</span>\n                            <span class="info-value">${(new Date).toLocaleString()}</span>\n                        </div>\n                    </div>\n                </div>\n            `,n.style.display="block")}populateFieldSelectors(e){["xAxisField","yAxisField","groupField"].forEach(n=>{const t=document.getElementById(n);t&&(t.innerHTML='<option value="">è‡ªåŠ¨è¯†åˆ«</option>',e.forEach(e=>{const n=document.createElement("option");n.value=e.id,n.textContent=`${e.name} (${this.getFieldTypeLabel(e.type)})`,n.dataset.type=e.type,t.appendChild(n)}))})}displayFieldRecognition(e){const n=document.getElementById("fieldRecognition"),t=document.getElementById("fieldBadges");if(n&&t){const a=this.analyzeFieldTypes(e);t.innerHTML=`\n                <div class="field-statistics">\n                    <span class="badge bg-primary">æ•°å€¼å­—æ®µ: ${a.numeric}</span>\n                    <span class="badge bg-success">æ–‡æœ¬å­—æ®µ: ${a.text}</span>\n                    <span class="badge bg-warning">æ—¥æœŸå­—æ®µ: ${a.date}</span>\n                    <span class="badge bg-info">å…¶ä»–å­—æ®µ: ${a.other}</span>\n                </div>\n                <div class="field-recommendations mt-2">\n                    <small class="text-muted">\n                        ğŸ’¡ ç³»ç»Ÿå·²è‡ªåŠ¨è¯†åˆ«é€‚åˆå›¾è¡¨çš„å­—æ®µç±»å‹\n                    </small>\n                </div>\n            `,n.style.display="block"}}analyzeFieldTypes(e){const n={numeric:0,text:0,date:0,other:0};return e.forEach(e=>{switch(e.type){case"number":case"currency":case"percent":case"formula":n.numeric++;break;case"text":case"select":case"multiselect":n.text++;break;case"date":case"datetime":n.date++;break;default:n.other++}}),n}autoSelectFields(e){if(e){if(e.xAxis){const n=document.getElementById("xAxisField");n&&(n.value=e.xAxis.id)}if(e.yAxis){const n=document.getElementById("yAxisField");n&&(n.value=e.yAxis.id)}if(e.group){const n=document.getElementById("groupField");n&&(n.value=e.group.id)}}}async generateChart(){try{this.showLoading("æ­£åœ¨ç”Ÿæˆå›¾è¡¨...");const e=document.getElementById("chartType").value,n=document.getElementById("xAxisField").value,t=document.getElementById("yAxisField").value,a=document.getElementById("groupField").value,i=n||this.fieldAnalyzer.getRecommendedXAxis()?.id,r=t||this.fieldAnalyzer.getRecommendedYAxis()?.id,o=a||this.fieldAnalyzer.getRecommendedGroupField()?.id;if(!i&&!r)throw new Error("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªå­—æ®µç”¨äºå›¾è¡¨ç”Ÿæˆ");const s=this.prepareChartData({chartType:e,xAxisField:i,yAxisField:r,groupField:o});await this.chartGenerator.generate(s),this.showChartPanel(),this.hideLoading(),this.showSuccess("å›¾è¡¨ç”ŸæˆæˆåŠŸï¼")}catch(e){this.hideLoading(),this.showError(`å›¾è¡¨ç”Ÿæˆå¤±è´¥: ${e.message}`)}}prepareChartData(e){const n=this.integration.getRecords(),t=this.integration.getFields();return{type:e.chartType,data:this.processDataForChart(n,e,t),fields:t,config:e}}processDataForChart(e,n,t){switch(n.chartType){case"bar":default:return this.processBarChartData(e,n,t);case"line":return this.processLineChartData(e,n,t);case"pie":return this.processPieChartData(e,n,t);case"scatter":return this.processScatterChartData(e,n,t);case"bubble":return this.processBubbleChartData(e,n,t)}}processBarChartData(e,n,t){const a=[],i=[];return e.forEach((e,n)=>{if(n<10){const r=t.find(e=>"text"===e.type),o=t.find(e=>"number"===e.type);r&&o&&(a.push(e.fields[r.id]||`é¡¹ç›® ${n+1}`),i.push(parseFloat(e.fields[o.id])||100*Math.random()))}}),{labels:a,datasets:[{label:"æ•°æ®å€¼",data:i,backgroundColor:"rgba(102, 126, 234, 0.8)",borderColor:"rgba(102, 126, 234, 1)",borderWidth:2,borderRadius:5}]}}processLineChartData(e,n,t){return this.processBarChartData(e,n,t)}processPieChartData(e,n,t){const a=this.processBarChartData(e,n,t);return{labels:a.labels,datasets:[{data:a.datasets[0].data,backgroundColor:["rgba(255, 99, 132, 0.8)","rgba(54, 162, 235, 0.8)","rgba(255, 205, 86, 0.8)","rgba(75, 192, 192, 0.8)","rgba(153, 102, 255, 0.8)"]}]}}processScatterChartData(e,n,t){const a=[];return e.forEach((e,n)=>{if(n<50){const n=t.find(e=>"number"===e.type),i=t.find(e=>"number"===e.type&&e.id!==n?.id);n&&i&&a.push({x:parseFloat(e.fields[n.id])||100*Math.random(),y:parseFloat(e.fields[i.id])||100*Math.random()})}}),{datasets:[{label:"æ•£ç‚¹æ•°æ®",data:a,backgroundColor:"rgba(102, 126, 234, 0.6)"}]}}processBubbleChartData(e,n,t){const a=[];return e.forEach((e,n)=>{if(n<30){const n=t.find(e=>"number"===e.type),i=t.find(e=>"number"===e.type&&e.id!==n?.id),r=t.find(e=>"number"===e.type&&e.id!==n?.id&&e.id!==i?.id);n&&i&&a.push({x:parseFloat(e.fields[n.id])||100*Math.random(),y:parseFloat(e.fields[i.id])||100*Math.random(),r:parseFloat(e.fields[r?.id])||20*Math.random()+5})}}),{datasets:[{label:"æ°”æ³¡æ•°æ®",data:a,backgroundColor:"rgba(255, 99, 132, 0.6)"}]}}showLoading(e){const n=document.getElementById("loadingOverlay"),t=document.getElementById("loadingText");n&&t&&(t.textContent=e,n.style.display="flex")}hideLoading(){const e=document.getElementById("loadingOverlay");e&&(e.style.display="none")}showSuccess(e){console.log(`âœ… ${e}`);const n=new bootstrap.Toast(document.getElementById("successToast"));document.getElementById("successMessage").textContent=e,n.show()}showError(e){console.error(`âŒ ${e}`);const n=new bootstrap.Modal(document.getElementById("errorModal")),t=document.getElementById("errorMessage");t&&(t.textContent=e),n.show()}getFieldTypeLabel(e){return{text:"æ–‡æœ¬",number:"æ•°å€¼",currency:"è´§å¸",percent:"ç™¾åˆ†æ¯”",date:"æ—¥æœŸ",datetime:"æ—¥æœŸæ—¶é—´",checkbox:"å¤é€‰æ¡†",select:"å•é€‰",multiselect:"å¤šé€‰",url:"é“¾æ¥",email:"é‚®ç®±",phone:"ç”µè¯",formula:"å…¬å¼"}[e]||e}handleInitializationError(e){console.error("åˆå§‹åŒ–é”™è¯¯:",e),this.showError(`æ’ä»¶åˆå§‹åŒ–å¤±è´¥: ${e.message}`),setTimeout(()=>{this.showManualConfig()},2e3)}showManualConfig(){console.log("åˆ‡æ¢åˆ°æ‰‹åŠ¨é…ç½®æ¨¡å¼")}},document.addEventListener("DOMContentLoaded",function(){console.log("ğŸš€ é£ä¹¦æ•°æ®å¯è§†åŒ–æ’ä»¶ DOM åŠ è½½å®Œæˆ"),setTimeout(()=>{window.feishuPlugin.initialize()},1e3)})})();